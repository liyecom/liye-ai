
# ğŸ—ºï¸ Data Source Mapping Configuration
# Version: Pilot-v1
# Purpose: Map source file headers (often CN) to Canonical Schema Fields (EN)

mappings:
  # --- 1. Amazon Ads (Campaign Level, Trad. Chinese) ---
  - profile_name: "amazon_ads_campaign_csv"
    source_system: "AMAZON_ADS"
    file_pattern: "Campaign_*.csv"
    target_table: "fact_ads_keyword_daily_campaign"
    sheet_name: null # CSV
    
    # Header Mapping (Source Header -> Canonical Field)
    field_map:
      "å»£å‘Šæ´»å‹•": "campaign_name_raw" # Will hash to campaign_id if ID not present
      "ç‹€æ…‹": "campaign_status"
      "é¡å‹": "ad_type_raw" # 'Sponsored Products' -> 'SP'
      "é»æ“Šæ¬¡æ•¸": "clicks"
      "æ”¯å‡º": "spend"
      "è¨‚å–®": "orders"
      "éŠ·é‡": "sales"
      "ROAS": "roas"
      "CTR": "ctr"
      "é ç®—": "budget"
      
    # Hardcoded or Derived Fields
    static_values:
      marketplace: "US" # Default, logic can override if filename has locale
      entry_type: "AD"
      resolution: "CAMPAIGN"
      attribution_window_days: 7

  # --- 2. Saihu (Campaign Level, Simpl. Chinese) ---
  - profile_name: "saihu_campaign_xlsx"
    source_system: "SAIHU"
    file_pattern: "TIMO-na-US*.xlsx"
    target_table: "fact_ads_keyword_daily_campaign"
    sheet_name: 0 
    
    field_map:
      "å¹¿å‘Šæ´»åŠ¨": "campaign_name_raw"
      "ç«™ç‚¹": "marketplace"
      "ç‚¹å‡»é‡": "clicks"
      "èŠ±è´¹": "spend"
      "è®¢å•é‡": "orders"
      "é”€å”®é¢": "sales"
      "ACOS": "acos"
      "ROAS": "roas"
      "åŠ è´­æ¬¡æ•°": "add_to_cart" # Rich Metric!
      "æ›å…‰é‡": "impressions"
      "æ ‡ç­¾": "tags"
      
    static_values:
      entry_type: "AD"
      resolution: "CAMPAIGN"
      data_confidence: "MED"

  # --- 3. Flywheel (Campaign Level, Simpl. Chinese) ---
  - profile_name: "flywheel_campaign_xlsx"
    source_system: "FLYWHEEL"
    file_pattern: "ç³»ç»Ÿ-TIMO*.xlsx"
    target_table: "fact_ads_keyword_daily_campaign"
    sheet_name: 0
    
    field_map:
      "å¹¿å‘Šæ´»åŠ¨": "campaign_name_raw"
      "é¢„ç®—": "budget"
      "ç«ä»·ç­–ç•¥": "bidding_strategy"
      # Usually Flywheel has perf metrics too, adding common ones if user re-exports with columns
      "èŠ±è´¹": "spend"
      "é”€å”®é¢": "sales"
      
    static_values:
      entry_type: "AD"
      resolution: "CAMPAIGN"
      
  # --- 4. Amazon Ads SP Search Term (Product - Traffic Deep Dive) ---
  - profile_name: "amazon_ads_sp_search_term_xlsx"
    source_system: "AMAZON_ADS"
    file_pattern: "å•†å“æ¨å»£_æœå°‹å­—è©_å ±å‘Š*.xlsx"
    target_table: "fact_keyword_entry_daily"
    sheet_name: 0
    
    field_map:
      "å»£å‘Šæ´»å‹•åç¨±": "campaign_id" # Hash later
      "å»£å‘Šç¾¤çµ„åç¨±": "ad_group_id"
      "å®¢æˆ¶æœå°‹å­—è©": "keyword"
      "åŒ¹é…é¡å‹": "match_type"
      "æ›å…‰æ•¸": "impressions"
      "é»æ“Šæ¬¡æ•¸": "clicks"
      "èŠ±è²»": "spend" # Check if it's æ”¯å‡º or èŠ±è²», loader will handle
      "æ”¯å‡º": "spend"
      "7 å¤©ç¸½è¨‚å–®æ•¸ (#)": "orders"
      "7 å¤©ç¸½éŠ·å”®é¡ ": "sales" # Added space
      "7 å¤©å–®ä½ç¸½æ•¸ (#)": "units"
      "å»£å‘Šå®šä½": "targeting" 
      
    static_values:
      entry_type: "AD"
      ad_type: "SP"
      recommendation_slot: "NONE"
      resolution: "SEARCH_TERM"
      attribution_window_days: 7
      placement: "ALL"

  # --- 5. Amazon Ads SB Keyword (Brand - Asset Builder) ---
  - profile_name: "amazon_ads_sb_keyword_xlsx"
    source_system: "AMAZON_ADS"
    file_pattern: "å“ç‰Œæ¨å»£_é—œéµå­—_å ±å‘Š*.xlsx"
    target_table: "fact_keyword_entry_daily" # Still useful even if Keyword level
    sheet_name: 0
    
    field_map:
      "å»£å‘Šæ´»å‹•åç¨±": "campaign_id"
      "é—œéµå­—": "keyword" # For SB Keyword report, this is the best proxy
      "åŒ¹é…é¡å‹": "match_type"
      "æ›å…‰æ•¸": "impressions"
      "é»æ“Šæ¬¡æ•¸": "clicks"
      "èŠ±è²»": "spend"
      "æ”¯å‡º": "spend"
      "14 å¤©ç¸½è¨‚å–®æ•¸ (#)": "orders"
      "14 å¤©ç¸½éŠ·å”®é¡ ": "sales" # Added space
      "14 å¤©æ–°å“ç‰Œå®¢æˆ¶è¨‚å–® (#)": "new_to_brand_orders"
      "14 å¤©å“ç‰Œæ–°å®¢æˆ¶éŠ·å”®": "new_to_brand_sales" # Fixed column name
      
    static_values:
      entry_type: "AD"
      ad_type: "SB"
      recommendation_slot: "NONE"
      resolution: "KEYWORD" # Note functionality difference
      attribution_window_days: 14
      asin: "BRAND_ASSET" # Placeholder for SB
      placement: "ALL"
      match_type: "UNKNOWN"

  # --- 6. SellersSprite Reverse ASIN (Market Intelligence) ---
  - profile_name: "sellersprite_reverse_asin_xlsx"
    source_system: "SELLERSPRITE"
    file_pattern: "ReverseASIN-*.xlsx"
    target_table: "fact_keyword_snapshot"
    sheet_name: 0
    
    field_map:
      "å…³é”®è¯": "keyword"
      "æœˆæœç´¢é‡": "search_volume"
      "è‡ªç„¶æ’å": "organic_rank"
      "æœˆæœç´¢é‡": "search_volume"
      "è‡ªç„¶æ’å": "organic_rank"
      "è‡ªç„¶æ’åé¡µç ": "rank_page_info_raw" # New raw field for parsing
      "å¹¿å‘Šæ’å": "ad_rank"
      "å¹¿å‘Šæ’åé¡µç ": "ad_rank_page_info_raw" # New raw field for Ad Page Info parsing
      "ABAå‘¨æ’å": "aba_rank"
      "æµé‡å æ¯”": "traffic_share" # Need to clean '%'
      "è½¬åŒ–æ€»å æ¯”": "conversion_share"
      "æ ‡é¢˜å¯†åº¦": "title_density"
      "SPR": "spr"
      "éœ€ä¾›æ¯”": "supply_demand_ratio"
      "å•†å“æ•°": "product_count"
      "è´­ä¹°é‡": "monthly_purchases"
      "è´­ä¹°ç‡": "purchase_rate" # Need to clean '%'
      "å±•ç¤ºé‡": "market_total_impressions"
      "ç‚¹å‡»é‡": "market_total_clicks"
      "è¿‘7å¤©å¹¿å‘Šç«å“æ•°": "advertised_product_count"
      "ç‚¹å‡»æ€»å æ¯”": "aba_top3_click_share"
      "è½¬åŒ–æ€»å æ¯”": "aba_top3_conversion_share"
      "PPCä»·æ ¼": "ppc_bid" # Parse '$'
      "å»ºè®®ç«ä»·èŒƒå›´": "ppc_bid_raw" # Parse '$Min-$Max'
      "æ›´æ–°æ—¶é—´": "source_updated_at_raw" # New raw field for timestamp parsing
      
    static_values:
      snapshot_type: "REVERSE_ASIN"
      marketplace: "US"
      # ASIN is now extracted dynamically from filename (e.g., ReverseASIN-B0C5Q9Y6YF.xlsx)

  # --- 7. Amazon Business Report (Organic Traffic Source) ---
  - profile_name: "amazon_business_report_csv"
    source_system: "AMAZON_BUSINESS_REPORT"
    file_pattern: "BusinessReport*.csv"
    target_table: "fact_asin_daily"
    
    field_map:
      "(å­) ASIN": "asin"
      "å·¥ä½œéšæ®µ - ç¸½è¨ˆ": "sessions"
      "é é¢ç€è¦½æ¬¡æ•¸ - ç¸½è¨ˆ": "page_views"
      "ç²¾é¸å„ªæƒ  (å ±åƒ¹é¡¯ç¤º) ç™¾åˆ†æ¯”": "buy_box_percentage"
      "å·²è¨‚è³¼å–®ä½æ•¸é‡": "units_ordered"
      "è¨‚è³¼ç”¢å“éŠ·å”®é¡": "sales"
      "å•†å“å·¥ä½œéšæ®µç™¾åˆ†æ¯”": "unit_session_percentage" # CVR
      
    static_values:
      marketplace: "US"
