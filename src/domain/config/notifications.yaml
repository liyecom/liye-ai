# Notification System Configuration
# Amazon Growth OS - Multi-Channel Notifications
# Version: 1.0

# Notification Channels
channels:
  # Email notifications
  email:
    enabled: false
    provider: "smtp"  # smtp | sendgrid | ses
    settings:
      smtp_host: ""
      smtp_port: 587
      smtp_user: ""
      smtp_password: ""  # Use env: SMTP_PASSWORD
      from_address: "alerts@amazon-growth-os.local"
      from_name: "Amazon Growth OS"
    default_recipients: []

  # Slack notifications
  slack:
    enabled: false
    webhook_url: ""  # Use env: SLACK_WEBHOOK_URL
    default_channel: "#amazon-alerts"
    mention_on_critical: true
    mention_users: []  # Slack user IDs to @ on critical

  # Push notifications (via Pushover, Pushbullet, or native)
  push:
    enabled: false
    provider: "pushover"  # pushover | pushbullet | ntfy
    settings:
      # Pushover settings
      pushover_user_key: ""  # Use env: PUSHOVER_USER_KEY
      pushover_api_token: ""  # Use env: PUSHOVER_API_TOKEN
      # Pushbullet settings
      pushbullet_api_key: ""  # Use env: PUSHBULLET_API_KEY
      # ntfy settings (self-hosted option)
      ntfy_server: "https://ntfy.sh"
      ntfy_topic: "amazon-growth-os"

  # Webhook (custom integration)
  webhook:
    enabled: false
    url: ""
    auth_header: ""  # Use env: WEBHOOK_AUTH_TOKEN
    method: "POST"
    content_type: "application/json"

  # Console (for testing/development)
  console:
    enabled: true
    color_output: true

# Alert Routing Rules
routing:
  # Map severity to channels
  severity_routing:
    critical:
      channels: ["slack", "push", "email"]
      immediate: true
    urgent:
      channels: ["slack", "push"]
      immediate: true
    warning:
      channels: ["slack", "email"]
      batch_minutes: 15  # Batch warnings
    opportunity:
      channels: ["slack"]
      batch_minutes: 60
    info:
      channels: ["console"]
      batch_minutes: 0  # Don't batch

  # Map alert types to channels
  type_routing:
    price_war:
      channels: ["slack", "push", "email"]
      priority: "critical"
    brand_crisis:
      channels: ["slack", "push", "email"]
      priority: "critical"
    competitor_oos:
      channels: ["slack"]
      priority: "opportunity"
    new_negative_review:
      channels: ["slack", "push"]
      priority: "urgent"
    health_score_drop:
      channels: ["slack", "email"]
      priority: "warning"
    acos_threshold:
      channels: ["slack"]
      priority: "warning"

  # Quiet hours (no notifications except critical)
  quiet_hours:
    enabled: true
    start: "22:00"
    end: "07:00"
    timezone: "America/Los_Angeles"
    allow_critical: true

# Notification Templates
templates:
  # Price alert template
  price_alert:
    subject: "[{severity}] Price Alert: {competitor_name}"
    title: "Price Alert"
    body: |
      **{competitor_name}** has changed their price.

      - **Product**: {product_name}
      - **Old Price**: ${old_price:.2f}
      - **New Price**: ${new_price:.2f}
      - **Change**: {change_pct:+.1f}%

      **Recommended Action**: {recommendation}
    slack_color:
      critical: "#FF0000"
      urgent: "#FF6600"
      warning: "#FFCC00"
      opportunity: "#00CC00"

  # Brand health alert template
  brand_health:
    subject: "[{severity}] Brand Health Alert: Score {score}/100"
    title: "Brand Health Alert"
    body: |
      Brand health score has changed.

      - **Current Score**: {score}/100 ({level})
      - **Previous Score**: {previous_score}/100
      - **Change**: {change:+.1f}

      **Key Issues**:
      {issues}

      **Recommended Strategy**: {strategy}
    slack_color:
      excellent: "#00CC00"
      good: "#66CC00"
      fair: "#FFCC00"
      poor: "#FF6600"
      critical: "#FF0000"

  # Review alert template
  review_alert:
    subject: "[{severity}] New {sentiment} Review: {rating}★"
    title: "Review Alert"
    body: |
      New review received for **{product_name}**.

      - **Rating**: {rating}★
      - **Sentiment**: {sentiment}
      - **ASIN**: {asin}

      **Review Snippet**:
      > {review_snippet}

      **Suggested Response**: {response_suggestion}

  # ACOS alert template
  acos_alert:
    subject: "[{severity}] ACOS Alert: {acos:.1f}% on {campaign_name}"
    title: "ACOS Alert"
    body: |
      ACOS has exceeded threshold.

      - **Campaign**: {campaign_name}
      - **Current ACOS**: {acos:.1f}%
      - **Target ACOS**: {target_acos:.1f}%
      - **Spend**: ${spend:.2f}
      - **Sales**: ${sales:.2f}

      **Recommendations**:
      {recommendations}

  # Flow completion template
  flow_complete:
    subject: "[INFO] Flow Complete: {flow_name}"
    title: "Flow Execution Complete"
    body: |
      Multi-agent flow has completed.

      - **Flow**: {flow_name}
      - **Flow ID**: {flow_id}
      - **Status**: {status}
      - **Duration**: {duration:.1f} seconds

      **Key Outputs**:
      {outputs}

      **Next Steps**:
      {recommendations}

  # Daily summary template
  daily_summary:
    subject: "Daily Summary: {date}"
    title: "Amazon Growth OS Daily Summary"
    body: |
      ## Daily Summary for {date}

      ### Brand Health
      - Score: {health_score}/100 ({health_level})
      - Rating: {rating}★

      ### Performance
      - Sales: ${sales:.2f}
      - ACOS: {acos:.1f}%
      - Orders: {orders}

      ### Alerts
      - Critical: {critical_count}
      - Warnings: {warning_count}
      - Opportunities: {opportunity_count}

      ### Top Actions
      {top_actions}

# Rate Limiting
rate_limits:
  # Max notifications per hour per channel
  per_hour:
    email: 10
    slack: 30
    push: 20
    webhook: 50

  # Cooldown between same alert type (minutes)
  cooldown:
    price_alert: 30
    review_alert: 15
    acos_alert: 60
    health_alert: 120

# Storage Settings
storage:
  db_path: "data/growth_os.duckdb"
  table: "fact_notifications"
  retention_days: 90
