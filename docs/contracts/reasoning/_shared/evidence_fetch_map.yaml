# Evidence Fetch Map v0.3
#
# P6-A: Maps evidence fields to their data sources with explicit unavailability tracking.
# This makes reasoning assets executable knowledge, not just documentation.
#
# source: GDP (Google Data Platform) | ENGINE (Amazon Growth Engine internal) | MANUAL | T1_TRUTH
# query_ref: SQL file reference or DuckDB query name
# fallback: none | approx | manual | strict_degrade (P6-A: forces low confidence)
# status: available | unavailable (P6-A: explicit unavailability tracking)
# degrade_reason: Why field is unavailable (required when status=unavailable)
#
# P6-A Coverage Target: ≥70% of playbook evidence_requirements mapped
# Fields from t1_ad_search_term_daily / t1_ad_campaign_daily are prioritized.

version: v0.3
updated_at: 2026-01-30

evidence_sources:

  # === ACoS & Performance Metrics ===

  acos:
    source: ENGINE
    query_ref: metrics.get_campaign_acos
    fallback: manual
    description: Advertising Cost of Sales = ad_spend / ad_sales
    unit: ratio
    refresh: daily

  ctr:
    source: ENGINE
    query_ref: metrics.get_ad_ctr
    fallback: manual
    description: Click-Through Rate = clicks / impressions
    unit: ratio
    refresh: daily

  unit_session_pct:
    source: ENGINE
    query_ref: metrics.get_listing_cvr
    fallback: approx
    description: Listing CVR = units / sessions
    unit: ratio
    refresh: daily
    note: Not the same as AD_CVR

  # === Product Lifecycle ===

  days_since_launch:
    source: ENGINE
    query_ref: products.get_days_since_launch
    fallback: manual
    description: Days since product first appeared on Amazon
    unit: days
    refresh: daily

  review_count:
    source: ENGINE
    query_ref: products.get_review_count
    fallback: approx
    description: Total number of customer reviews
    unit: count
    refresh: daily

  rating:
    source: ENGINE
    query_ref: products.get_rating
    fallback: approx
    description: Average customer rating (1-5 stars)
    unit: stars
    refresh: daily

  # === Keyword & Search Metrics ===

  wasted_spend_ratio:
    source: ENGINE
    query_ref: keywords.get_wasted_spend_ratio
    fallback: approx
    description: Ratio of spend on non-converting search terms
    unit: ratio
    refresh: weekly

  search_term_relevance_score:
    source: ENGINE
    query_ref: keywords.get_relevance_score
    fallback: none
    description: Semantic relevance between search term and product
    unit: score_0_1
    refresh: weekly
    note: Requires ML pipeline

  # === Bidding & Cost Metrics ===

  cpc:
    source: ENGINE
    query_ref: campaigns.get_avg_cpc
    fallback: approx
    description: Average Cost Per Click
    unit: currency
    refresh: daily

  category_avg_cpc:
    source: GDP
    query_ref: benchmarks/category_cpc.sql
    fallback: approx
    description: Category average CPC from GDP benchmarks
    unit: currency
    refresh: weekly

  # === Competitive Intelligence ===

  price_percentile:
    source: ENGINE
    query_ref: products.get_price_percentile
    fallback: approx
    description: Price position within category (0=cheapest, 1=most expensive)
    unit: percentile
    refresh: daily

  category_avg_price:
    source: GDP
    query_ref: benchmarks/category_price.sql
    fallback: approx
    description: Average price in the product category
    unit: currency
    refresh: weekly

  # === Match Type & Targeting ===

  broad_match_spend_pct:
    source: ENGINE
    query_ref: campaigns.get_match_type_spend_distribution
    fallback: approx
    description: Percentage of ad spend on broad match keywords
    unit: ratio
    refresh: daily

  exact_match_spend_pct:
    source: ENGINE
    query_ref: campaigns.get_match_type_spend_distribution
    fallback: approx
    description: Percentage of ad spend on exact match keywords
    unit: ratio
    refresh: daily

  phrase_match_spend_pct:
    source: ENGINE
    query_ref: campaigns.get_match_type_spend_distribution
    fallback: approx
    description: Percentage of ad spend on phrase match keywords
    unit: ratio
    refresh: daily

  # === Negative Keywords ===

  negative_keyword_count:
    source: ENGINE
    query_ref: campaigns.get_negative_keyword_count
    fallback: approx
    description: Total number of negative keywords across campaigns
    unit: count
    refresh: daily

  negative_to_positive_ratio:
    source: ENGINE
    query_ref: campaigns.get_negative_positive_ratio
    fallback: approx
    description: Ratio of negative keywords to positive keywords
    unit: ratio
    refresh: daily

  # === Auto Campaign Metrics ===

  auto_campaign_spend_pct:
    source: ENGINE
    query_ref: campaigns.get_auto_spend_percentage
    fallback: approx
    description: Percentage of total ad spend on auto campaigns
    unit: ratio
    refresh: daily

  auto_campaign_acos:
    source: ENGINE
    query_ref: campaigns.get_auto_campaign_acos
    fallback: approx
    description: ACoS specifically for auto campaigns
    unit: ratio
    refresh: daily

  # === Search Term Analysis ===

  search_term_count:
    source: ENGINE
    query_ref: search_terms.get_unique_count
    fallback: approx
    description: Number of unique search terms triggering ads
    unit: count
    refresh: weekly

  irrelevant_term_pct:
    source: ENGINE
    query_ref: search_terms.get_irrelevant_percentage
    fallback: approx
    description: Percentage of search terms deemed irrelevant
    unit: ratio
    refresh: weekly
    note: Requires relevance scoring

  category_mismatch_rate:
    source: ENGINE
    query_ref: search_terms.get_category_mismatch_rate
    fallback: none
    description: Rate of search terms from wrong product categories
    unit: ratio
    refresh: weekly

  # === Listing Quality ===

  listing_quality_score:
    source: ENGINE
    query_ref: listings.get_quality_score
    fallback: approx
    description: Overall listing quality score (0-100)
    unit: score
    refresh: daily

  bullet_point_count:
    source: ENGINE
    query_ref: listings.get_bullet_count
    fallback: manual
    description: Number of bullet points in listing
    unit: count
    refresh: daily

  a_plus_content_enabled:
    source: ENGINE
    query_ref: listings.has_a_plus
    fallback: manual
    description: Whether A+ Content is enabled
    unit: boolean
    refresh: daily

  description_length:
    source: ENGINE
    query_ref: listings.get_description_length
    fallback: manual
    description: Character count of product description
    unit: count
    refresh: daily

  title_length:
    source: ENGINE
    query_ref: listings.get_title_length
    fallback: manual
    description: Character count of product title
    unit: count
    refresh: daily

  title_keyword_coverage:
    source: ENGINE
    query_ref: listings.get_title_keyword_coverage
    fallback: approx
    description: Ratio of target keywords present in title
    unit: ratio
    refresh: weekly

  main_image_score:
    source: ENGINE
    query_ref: listings.get_main_image_score
    fallback: none
    description: Quality score of main product image (0-1)
    unit: score_0_1
    refresh: weekly
    note: Requires image analysis

  # === Inventory & Stock ===

  in_stock_rate:
    source: ENGINE
    query_ref: inventory.get_in_stock_rate
    fallback: approx
    description: Percentage of time product was in stock
    unit: ratio
    refresh: daily

  stockout_days_30d:
    source: ENGINE
    query_ref: inventory.get_stockout_days
    fallback: approx
    description: Number of days out of stock in last 30 days
    unit: days
    refresh: daily

  current_inventory_days:
    source: ENGINE
    query_ref: inventory.get_days_of_supply
    fallback: approx
    description: Estimated days of inventory remaining
    unit: days
    refresh: daily

  # === BuyBox & Eligibility ===

  buybox_win_rate:
    source: ENGINE
    query_ref: products.get_buybox_win_rate
    fallback: approx
    description: Percentage of time winning the Buy Box
    unit: ratio
    refresh: daily

  prime_eligible:
    source: ENGINE
    query_ref: products.is_prime_eligible
    fallback: manual
    description: Whether product is Prime eligible
    unit: boolean
    refresh: daily

  listing_status:
    source: ENGINE
    query_ref: listings.get_status
    fallback: manual
    description: Current listing status (active/suppressed/etc)
    unit: enum
    refresh: daily

  # === Budget & Pacing ===

  daily_budget:
    source: ENGINE
    query_ref: campaigns.get_daily_budget
    fallback: manual
    description: Configured daily budget for campaign
    unit: currency
    refresh: daily

  budget_pacing:
    source: ENGINE
    query_ref: campaigns.get_budget_pacing
    fallback: approx
    description: Current spend rate vs ideal even pacing
    unit: ratio
    refresh: hourly

  budget_exhaust_hour:
    source: ENGINE
    query_ref: campaigns.get_budget_exhaust_hour
    fallback: approx
    description: Hour of day when budget was exhausted (0-23)
    unit: hour
    refresh: daily

  budget_utilization_rate:
    source: ENGINE
    query_ref: campaigns.get_budget_utilization
    fallback: approx
    description: Percentage of daily budget spent
    unit: ratio
    refresh: daily

  # === Keyword Volume & Coverage ===

  keyword_search_volume_avg:
    source: GDP
    query_ref: keywords/search_volume.sql
    fallback: approx
    description: Average monthly search volume of targeted keywords
    unit: count
    refresh: monthly

  keyword_count:
    source: ENGINE
    query_ref: campaigns.get_keyword_count
    fallback: manual
    description: Total number of keywords being targeted
    unit: count
    refresh: daily

  impression_share:
    source: ENGINE
    query_ref: campaigns.get_impression_share
    fallback: approx
    description: Share of total available impressions won
    unit: ratio
    refresh: daily

  suggested_bid:
    source: ENGINE
    query_ref: keywords.get_suggested_bid
    fallback: approx
    description: Amazon's suggested bid for keyword
    unit: currency
    refresh: daily

  bid:
    source: ENGINE
    query_ref: keywords.get_current_bid
    fallback: manual
    description: Current bid amount for keyword
    unit: currency
    refresh: realtime

  # === Sales Velocity & Ranking ===

  sales_velocity_7d:
    source: ENGINE
    query_ref: products.get_sales_velocity_7d
    fallback: approx
    description: Average daily units sold over last 7 days
    unit: units_per_day
    refresh: daily

  sales_velocity_30d:
    source: ENGINE
    query_ref: products.get_sales_velocity_30d
    fallback: approx
    description: Average daily units sold over last 30 days
    unit: units_per_day
    refresh: daily

  organic_rank:
    source: ENGINE
    query_ref: keywords.get_organic_rank
    fallback: none
    description: Organic search rank for keyword (1=best)
    unit: position
    refresh: daily

  review_velocity:
    source: ENGINE
    query_ref: products.get_review_velocity
    fallback: approx
    description: Rate of new reviews per week
    unit: count_per_week
    refresh: weekly

  # === Competitor Metrics ===

  competitor_rank_change:
    source: ENGINE
    query_ref: competitors.get_rank_change
    fallback: none
    description: Change in competitor's rank over period
    unit: delta
    refresh: daily

  competitor_price_history:
    source: ENGINE
    query_ref: competitors.get_price_history
    fallback: none
    description: Historical price data for competitor
    unit: currency_series
    refresh: daily

  competitor_days_on_market:
    source: ENGINE
    query_ref: competitors.get_days_on_market
    fallback: approx
    description: Days since competitor product launched
    unit: days
    refresh: daily

  category_avg_price_trend:
    source: GDP
    query_ref: benchmarks/category_price_trend.sql
    fallback: approx
    description: Trend of average category price over time
    unit: trend
    refresh: weekly

  # === Campaign Structure ===

  campaign_count:
    source: ENGINE
    query_ref: campaigns.get_active_count
    fallback: manual
    description: Number of active campaigns for product
    unit: count
    refresh: daily

  keyword_overlap_ratio:
    source: ENGINE
    query_ref: campaigns.get_keyword_overlap
    fallback: approx
    description: Ratio of keywords appearing in multiple campaigns
    unit: ratio
    refresh: weekly

  top_5_keyword_spend_pct:
    source: ENGINE
    query_ref: keywords.get_top5_spend_share
    fallback: approx
    description: Percentage of spend consumed by top 5 keywords
    unit: ratio
    refresh: daily

  # === Return & Quality Issues ===

  return_rate:
    source: ENGINE
    query_ref: products.get_return_rate
    fallback: approx
    description: Percentage of units returned
    unit: ratio
    refresh: weekly

  bounce_rate:
    source: ENGINE
    query_ref: listings.get_bounce_rate
    fallback: none
    description: Rate of visitors leaving without action
    unit: ratio
    refresh: daily
    note: Requires Brand Analytics

  # === Top of Search ===

  top_of_search_share:
    source: ENGINE
    query_ref: campaigns.get_tos_impression_share
    fallback: approx
    description: Share of top-of-search ad impressions
    unit: ratio
    refresh: daily

  # === Budget Governance ===

  proposed_amount:
    source: ENGINE
    query_ref: context.proposed_spend
    fallback: none
    description: The amount being proposed in the current action
    unit: currency
    refresh: realtime

  limit_value:
    source: ENGINE
    query_ref: contracts.get_budget_limit
    fallback: none
    description: The configured budget limit from governance contract
    unit: currency
    refresh: realtime

# =============================================================================
# P6-A: T1 Truth Derivable Fields (from t1_ad_search_term_daily / t1_ad_campaign_daily)
# =============================================================================
# These fields can be derived from real Amazon Ads data in T1 Truth tables.

  # --- Core T1 Truth Fields (Direct from table) ---

  impressions:
    source: T1_TRUTH
    query_ref: t1_truth/search_term_impressions.sql
    fallback: none
    description: Total ad impressions from t1_ad_search_term_daily
    unit: count
    refresh: daily
    status: available

  clicks:
    source: T1_TRUTH
    query_ref: t1_truth/search_term_clicks.sql
    fallback: none
    description: Total ad clicks from t1_ad_search_term_daily
    unit: count
    refresh: daily
    status: available

  cost:
    source: T1_TRUTH
    query_ref: t1_truth/search_term_cost.sql
    fallback: none
    description: Total ad spend from t1_ad_search_term_daily
    unit: currency
    refresh: daily
    status: available

  attributed_sales_7d:
    source: T1_TRUTH
    query_ref: t1_truth/search_term_sales.sql
    fallback: none
    description: 7-day attributed sales from t1_ad_search_term_daily
    unit: currency
    refresh: daily
    status: available

  attributed_conversions_7d:
    source: T1_TRUTH
    query_ref: t1_truth/search_term_conversions.sql
    fallback: none
    description: 7-day conversion count from t1_ad_search_term_daily
    unit: count
    refresh: daily
    status: available

  campaign_budget:
    source: T1_TRUTH
    query_ref: t1_truth/campaign_budget.sql
    fallback: manual
    description: Campaign daily budget from t1_ad_campaign_daily
    unit: currency
    refresh: daily
    status: available

  campaign_status:
    source: T1_TRUTH
    query_ref: t1_truth/campaign_status.sql
    fallback: manual
    description: Campaign status (ENABLED/PAUSED/ARCHIVED)
    unit: enum
    refresh: daily
    status: available

  match_type:
    source: T1_TRUTH
    query_ref: t1_truth/search_term_match_type.sql
    fallback: none
    description: Keyword match type from t1_ad_search_term_daily
    unit: enum
    refresh: daily
    status: available

  # --- Derived Metrics (Computed from T1 Truth) ---

  cvr:
    source: T1_TRUTH
    query_ref: t1_truth/derived/cvr.sql
    fallback: approx
    description: Conversion rate = attributed_conversions_7d / clicks
    unit: ratio
    refresh: daily
    status: available
    note: Derived from t1_ad_search_term_daily

  roas:
    source: T1_TRUTH
    query_ref: t1_truth/derived/roas.sql
    fallback: approx
    description: Return on Ad Spend = attributed_sales_7d / cost
    unit: ratio
    refresh: daily
    status: available
    note: Derived from t1_ad_search_term_daily

  # --- Aggregated Metrics (Computed from T1 Truth) ---

  total_spend_7d:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/total_spend_7d.sql
    fallback: approx
    description: Total spend over 7 days aggregated from t1_ad_search_term_daily
    unit: currency
    refresh: daily
    status: available

  campaign_spend_distribution:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/campaign_spend_distribution.sql
    fallback: approx
    description: Spend distribution across campaigns
    unit: distribution
    refresh: daily
    status: available

  search_term_performance:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/search_term_performance.sql
    fallback: none
    description: Performance metrics grouped by search term
    unit: aggregate
    refresh: daily
    status: available

  zero_conversion_terms:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/zero_conversion_terms.sql
    fallback: none
    description: Search terms with clicks but zero conversions
    unit: list
    refresh: daily
    status: available
    note: Core input for ADD_NEGATIVE_KEYWORDS action

  high_spend_low_roas_terms:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/high_spend_low_roas.sql
    fallback: none
    description: Terms with high spend but low ROAS
    unit: list
    refresh: daily
    status: available

  # --- ADD_NEGATIVE_KEYWORDS Action Evidence ---

  search_term_report:
    source: T1_TRUTH
    query_ref: t1_truth/search_term_report.sql
    fallback: none
    description: Full search term report from t1_ad_search_term_daily
    unit: report
    refresh: daily
    status: available
    note: Core input for ADD_NEGATIVE_KEYWORDS action

  wasted_spend_by_term:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/wasted_spend_by_term.sql
    fallback: none
    description: Spend on terms with zero conversions grouped by term
    unit: aggregate
    refresh: daily
    status: available
    note: Identifies negative keyword candidates

  campaign_negatives:
    source: ENGINE
    query_ref: campaigns.get_negative_keywords
    fallback: manual
    description: Current negative keyword list for campaign
    unit: list
    refresh: daily
    status: available
    note: Prevents duplicate negative keyword additions

  brand_terms:
    source: ENGINE
    query_ref: config.get_brand_terms
    fallback: manual
    description: Protected brand terms that should not be negatived
    unit: list
    refresh: daily
    status: available
    note: Safety filter for ADD_NEGATIVE_KEYWORDS

  # =============================================================================
  # P6-A PR-B2: Top 20 Missing Reachable Fields (Now Available)
  # =============================================================================
  # These fields were identified as "missing reachable" in the US 14d pilot.
  # PR-B2 connects them to T1 Truth tables with executable queries.
  # Target: Raise reachable coverage from 54.2% to 72.9% (≥70% gate).

  # --- Priority 0: Core Waste Diagnostics ---

  match_type_distribution:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/match_type_distribution.sql
    fallback: none
    description: Spend distribution across match types (BROAD/PHRASE/EXACT)
    unit: distribution
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No search term data for date range"
      degrade_when: "Single match type only (no distribution)"
      degrade_reason: "Insufficient match type diversity"
    note: "PR-B2: Core for diagnosing broad match waste"

  keyword_spend_distribution:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/keyword_spend_distribution.sql
    fallback: none
    description: Spend concentration across keywords (top N vs long tail)
    unit: distribution
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No search term data for date range"
      degrade_when: "Fewer than 10 unique keywords"
      degrade_reason: "Insufficient keyword volume for distribution"
    note: "PR-B2: Core for budget concentration analysis"

  zero_conversion_spend_pct:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/zero_conversion_spend_pct.sql
    fallback: none
    description: Percentage of total spend on terms with zero conversions
    unit: ratio
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No search term data for date range"
      degrade_when: "Never - always computable from T1"
      degrade_reason: null
    note: "PR-B2: Core metric for negative keyword recommendations"

  # --- Priority 1: Conversion & Efficiency ---

  conversion_rate_by_term:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/conversion_rate_by_term.sql
    fallback: none
    description: CVR grouped by search term (conversions/clicks)
    unit: aggregate
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No search term data for date range"
      degrade_when: "Terms with zero clicks excluded"
      degrade_reason: "Cannot compute CVR without clicks"
    note: "PR-B2: Essential for identifying low-converting terms"

  high_click_low_conversion_terms:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/high_click_low_conversion.sql
    fallback: none
    description: Terms with clicks ≥5 but zero conversions (waste candidates)
    unit: list
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No terms meet threshold"
      degrade_when: "Never - list can be empty"
      degrade_reason: null
    note: "PR-B2: Direct input for ADD_NEGATIVE_KEYWORDS"

  search_term_efficiency:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/search_term_efficiency.sql
    fallback: none
    description: ROAS by search term (sales/cost per term)
    unit: aggregate
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No search term data for date range"
      degrade_when: "Terms with zero cost excluded"
      degrade_reason: "Cannot compute ROAS without spend"
    note: "PR-B2: Identifies high-value vs low-value terms"

  # --- Priority 2: Budget & Campaign Analysis ---

  campaign_acos_variance:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/campaign_acos_variance.sql
    fallback: approx
    description: ACOS variance across campaigns (std dev)
    unit: ratio
    refresh: daily
    status: available
    availability_contract:
      empty_when: "Fewer than 2 campaigns"
      degrade_when: "Single campaign only"
      degrade_reason: "Cannot compute variance with one campaign"
    note: "PR-B2: Identifies outlier campaigns"

  avg_cpc_by_campaign:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/avg_cpc_by_campaign.sql
    fallback: approx
    description: Average CPC grouped by campaign
    unit: currency
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No campaign data for date range"
      degrade_when: "Campaigns with zero clicks"
      degrade_reason: "Cannot compute CPC without clicks"
    note: "PR-B2: Benchmark for bid optimization"

  campaign_spend_trend:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/campaign_spend_trend.sql
    fallback: approx
    description: Daily spend trend by campaign over date range
    unit: time_series
    refresh: daily
    status: available
    availability_contract:
      empty_when: "Single day data only"
      degrade_when: "Fewer than 7 days of data"
      degrade_reason: "Insufficient time series for trend"
    note: "PR-B2: Detects spend acceleration/deceleration"

  # --- Priority 3: Secondary Metrics ---

  bid_vs_budget_ratio:
    source: T1_TRUTH
    query_ref: t1_truth/derived/bid_vs_budget_ratio.sql
    fallback: approx
    description: Average bid / daily budget ratio
    unit: ratio
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No bid or budget data"
      degrade_when: "Budget is zero"
      degrade_reason: "Cannot compute ratio with zero budget"
    note: "PR-B2: Bid aggressiveness indicator"

  sales_velocity_trend:
    source: T1_TRUTH
    query_ref: t1_truth/derived/sales_velocity_trend.sql
    fallback: approx
    description: Sales velocity change (7d vs 14d comparison)
    unit: trend
    refresh: daily
    status: available
    availability_contract:
      empty_when: "Fewer than 14 days of data"
      degrade_when: "7-14 day data incomplete"
      degrade_reason: "Requires full 14d window"
    note: "PR-B2: Detects sales momentum"

  impressions_per_spend:
    source: T1_TRUTH
    query_ref: t1_truth/derived/impressions_per_spend.sql
    fallback: approx
    description: Impressions per dollar spent (efficiency metric)
    unit: ratio
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No spend data"
      degrade_when: "Zero spend (division by zero)"
      degrade_reason: "Cannot compute without spend"
    note: "PR-B2: Visibility efficiency metric"

  daily_spend_variance:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/daily_spend_variance.sql
    fallback: approx
    description: Variance in daily spend (spend stability)
    unit: currency
    refresh: daily
    status: available
    availability_contract:
      empty_when: "Single day data only"
      degrade_when: "Fewer than 7 days"
      degrade_reason: "Insufficient data for variance"
    note: "PR-B2: Budget stability indicator"

  low_impression_terms:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/low_impression_terms.sql
    fallback: none
    description: Terms with fewer than 100 impressions
    unit: list
    refresh: daily
    status: available
    availability_contract:
      empty_when: "All terms have ≥100 impressions"
      degrade_when: "Never - list can be empty"
      degrade_reason: null
    note: "PR-B2: Identifies underperforming terms"

  spend_concentration_index:
    source: T1_TRUTH
    query_ref: t1_truth/derived/spend_concentration_index.sql
    fallback: approx
    description: Gini coefficient of spend across terms (0=equal, 1=concentrated)
    unit: ratio
    refresh: daily
    status: available
    availability_contract:
      empty_when: "Fewer than 2 terms"
      degrade_when: "Single term only"
      degrade_reason: "Cannot compute concentration with one term"
    note: "PR-B2: Budget concentration metric"

  click_concentration_index:
    source: T1_TRUTH
    query_ref: t1_truth/derived/click_concentration_index.sql
    fallback: approx
    description: Gini coefficient of clicks across terms
    unit: ratio
    refresh: daily
    status: available
    availability_contract:
      empty_when: "Fewer than 2 terms with clicks"
      degrade_when: "Single term only"
      degrade_reason: "Cannot compute concentration with one term"
    note: "PR-B2: Click concentration metric"

  campaign_saturation:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/campaign_saturation.sql
    fallback: approx
    description: Budget exhaustion pattern (early/even/late)
    unit: enum
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No hourly data available"
      degrade_when: "Daily granularity only - uses spend/budget proxy"
      degrade_reason: "T1 has daily granularity, approximating from utilization"
    note: "PR-B2: Approximated from budget_utilization_rate"

  auto_vs_manual_spend_ratio:
    source: T1_TRUTH
    query_ref: t1_truth/aggregated/auto_vs_manual_spend_ratio.sql
    fallback: approx
    description: Ratio of auto campaign spend to manual campaign spend
    unit: ratio
    refresh: daily
    status: available
    availability_contract:
      empty_when: "No campaign type classification"
      degrade_when: "Campaign names don't follow auto/manual naming convention"
      degrade_reason: "Requires campaign type inference from name"
    note: "PR-B2: Inferred from campaign_name patterns (auto/manual/discovery)"

# =============================================================================
# P6-A: Unavailable Fields (Require External Sources or New Pipelines)
# =============================================================================
# These fields are referenced in playbooks but cannot be fetched from current
# t1_* tables. They are explicitly marked as unavailable with degrade_reason.

unavailable_fields:

  avg_daily_spend_potential:
    status: unavailable
    degrade_reason: requires_market_intelligence_pipeline
    fallback: strict_degrade
    description: Potential daily spend based on market demand
    note: Would require integration with Amazon Ads forecasting API

  market_demand:
    status: unavailable
    degrade_reason: requires_external_market_data
    fallback: strict_degrade
    description: Market demand indicator for product category
    note: Requires external market research data source

  competitor_inventory_estimate:
    status: unavailable
    degrade_reason: requires_competitor_scraping
    fallback: strict_degrade
    description: Estimated competitor inventory levels
    note: Requires third-party competitive intelligence

  competitor_review_trend:
    status: unavailable
    degrade_reason: requires_competitor_monitoring
    fallback: strict_degrade
    description: Trend of competitor review velocity
    note: Requires historical competitor data tracking

  image_vs_product_similarity:
    status: unavailable
    degrade_reason: requires_ml_image_analysis
    fallback: strict_degrade
    description: Similarity score between main image and actual product
    note: Requires image ML pipeline

  negative_review_content_mismatch_pct:
    status: unavailable
    degrade_reason: requires_nlp_review_analysis
    fallback: strict_degrade
    description: Percentage of negative reviews citing content mismatch
    note: Requires NLP pipeline for review sentiment analysis

  title_readability_score:
    status: unavailable
    degrade_reason: requires_nlp_text_analysis
    fallback: strict_degrade
    description: Readability score of product title
    note: Requires NLP text analysis pipeline

  content_change_log:
    status: unavailable
    degrade_reason: requires_event_sourcing_system
    fallback: strict_degrade
    description: Log of content changes to listing
    note: Requires listing change tracking system

  keyword_index_status:
    status: unavailable
    degrade_reason: requires_seller_central_integration
    fallback: strict_degrade
    description: Whether keyword is indexed for organic search
    note: Requires Seller Central API or scraping

  last_price_change_date:
    status: unavailable
    degrade_reason: requires_price_history_tracking
    fallback: strict_degrade
    description: Date of last price change
    note: Requires price history event tracking

  our_price_history:
    status: unavailable
    degrade_reason: requires_price_history_tracking
    fallback: strict_degrade
    description: Historical price series for our product
    note: Requires price history event tracking

  our_price_vs_category_percentile:
    status: unavailable
    degrade_reason: requires_category_benchmark_data
    fallback: strict_degrade
    description: Our price position vs category
    note: Requires category benchmark data

  image_a_plus_enabled:
    status: unavailable
    degrade_reason: requires_listing_api
    fallback: manual
    description: Whether A+ images are enabled
    note: Requires Seller Central or SP-API catalog

  backend_keywords_filled:
    status: unavailable
    degrade_reason: requires_listing_api
    fallback: manual
    description: Whether backend keywords are populated
    note: Requires SP-API catalog access

  suppression_reason:
    status: unavailable
    degrade_reason: requires_listing_api
    fallback: manual
    description: Reason for listing suppression
    note: Requires SP-API notifications

  rating_trend_30d:
    status: unavailable
    degrade_reason: requires_rating_history
    fallback: approx
    description: Rating change over 30 days
    note: Requires historical rating tracking

  recent_negative_reviews:
    status: unavailable
    degrade_reason: requires_review_monitoring
    fallback: approx
    description: Count of recent negative reviews
    note: Requires review monitoring system

  competitor_origin_country:
    status: unavailable
    degrade_reason: requires_competitor_profiling
    fallback: strict_degrade
    description: Country of origin for competitor products
    note: Requires third-party competitive intelligence

  competitor_product_weight:
    status: unavailable
    degrade_reason: requires_competitor_catalog
    fallback: strict_degrade
    description: Weight of competitor products (for shipping cost estimation)
    note: Requires competitor catalog data

  competitor_fulfillment_type:
    status: unavailable
    degrade_reason: requires_competitor_monitoring
    fallback: strict_degrade
    description: FBA vs FBM for competitor
    note: Requires Buy Box monitoring

  top_10_competitor_price_trend:
    status: unavailable
    degrade_reason: requires_competitor_price_tracking
    fallback: strict_degrade
    description: Price trend of top 10 competitors
    note: Requires competitor price history

  category_demand_trend:
    status: unavailable
    degrade_reason: requires_market_data
    fallback: approx
    description: Trend of category demand over time
    note: Would require Amazon market research data

  hourly_spend_distribution:
    status: unavailable
    degrade_reason: requires_hourly_granularity
    fallback: approx
    description: Spend distribution by hour of day
    note: T1 Truth has daily granularity only

  peak_vs_offpeak_cpc:
    status: unavailable
    degrade_reason: requires_hourly_granularity
    fallback: approx
    description: CPC comparison between peak and off-peak hours
    note: T1 Truth has daily granularity only

  long_tail_keyword_coverage:
    status: unavailable
    degrade_reason: requires_keyword_classification
    fallback: approx
    description: Coverage of long-tail keywords
    note: Requires keyword taxonomy classification

  auto_to_manual_harvest_rate:
    status: unavailable
    degrade_reason: requires_campaign_history_tracking
    fallback: approx
    description: Rate of promoting terms from auto to manual campaigns
    note: Requires campaign change tracking

  recurring_waste_terms:
    status: unavailable
    degrade_reason: requires_historical_analysis
    fallback: approx
    description: Terms that repeatedly waste spend
    note: Requires multi-period historical analysis

  semantic_similarity_avg:
    status: unavailable
    degrade_reason: requires_ml_semantic_analysis
    fallback: strict_degrade
    description: Average semantic similarity of search terms to product
    note: Requires ML semantic analysis pipeline

  # --- Additional Missing Fields (from playbook scan) ---

  # bid_vs_budget_ratio: MOVED to PR-B2 Reachable Fields section

  # keyword_spend_distribution: MOVED to PR-B2 Reachable Fields section

  competitor_review_count:
    status: unavailable
    degrade_reason: requires_competitor_monitoring
    fallback: strict_degrade
    description: Number of reviews for competitor products
    note: Requires third-party competitive intelligence

  competitor_price_vs_category:
    status: unavailable
    degrade_reason: requires_competitor_monitoring
    fallback: strict_degrade
    description: Competitor price relative to category average
    note: Requires competitor price data + category benchmarks

  competitor_image_benchmark:
    status: unavailable
    degrade_reason: requires_ml_image_analysis
    fallback: strict_degrade
    description: Image quality benchmark from competitors
    note: Requires image analysis ML pipeline

  keyword_product_match_rate:
    status: unavailable
    degrade_reason: requires_ml_semantic_analysis
    fallback: strict_degrade
    description: Match rate between keywords and product
    note: Requires semantic similarity analysis

  irrelevant_impression_pct:
    status: unavailable
    degrade_reason: requires_relevance_scoring
    fallback: approx
    description: Percentage of impressions from irrelevant terms
    note: Requires search term relevance classification

  estimated_delivery_days:
    status: unavailable
    degrade_reason: requires_fulfillment_api
    fallback: manual
    description: Estimated delivery time for product
    note: Requires SP-API fulfillment data

  budget_exhaust_time:
    status: unavailable
    degrade_reason: requires_hourly_granularity
    fallback: approx
    description: Time when budget was exhausted
    note: T1 Truth has daily granularity only

  keyword_coverage_rate:
    status: unavailable
    degrade_reason: requires_keyword_taxonomy
    fallback: approx
    description: Coverage rate of target keywords
    note: Requires keyword taxonomy definition

  # match_type_distribution: MOVED to PR-B2 Reachable Fields section

  asin_targeting_only:
    status: unavailable
    degrade_reason: requires_campaign_structure_api
    fallback: manual
    description: Whether campaign uses ASIN targeting exclusively
    note: Requires campaign targeting configuration

  auto_campaign_enabled:
    status: unavailable
    degrade_reason: requires_campaign_structure_api
    fallback: manual
    description: Whether auto campaigns are enabled
    note: Requires campaign configuration data

  buybox_eligible:
    status: unavailable
    degrade_reason: requires_catalog_api
    fallback: manual
    description: BuyBox eligibility status
    note: Requires SP-API catalog data

  # sales_velocity_trend: MOVED to PR-B2 Reachable Fields section

  competitor_review_velocity:
    status: unavailable
    degrade_reason: requires_competitor_monitoring
    fallback: strict_degrade
    description: Rate of new reviews for competitors
    note: Requires competitor review tracking

  competitor_price_change:
    status: unavailable
    degrade_reason: requires_competitor_price_tracking
    fallback: strict_degrade
    description: Recent price change by competitors
    note: Requires competitor price history

  inventory_health_score:
    status: unavailable
    degrade_reason: requires_inventory_api
    fallback: approx
    description: Overall inventory health score
    note: Requires FBA inventory health data

  bid_adjustment_enabled:
    status: unavailable
    degrade_reason: requires_campaign_structure_api
    fallback: manual
    description: Whether dynamic bidding is enabled
    note: Requires campaign bidding configuration

  placement_performance:
    status: unavailable
    degrade_reason: requires_placement_report
    fallback: approx
    description: Performance metrics by ad placement
    note: Requires placement-level report data

  # auto_vs_manual_spend_ratio: MOVED to PR-B2 Reachable Fields section

  acos:
    source: T1_TRUTH
    query_ref: t1_truth/derived/acos.sql
    fallback: approx
    description: Advertising Cost of Sales = cost / attributed_sales_7d
    unit: ratio
    refresh: daily
    status: available
    note: Derived from t1_ad_search_term_daily

  organic_rank:
    status: unavailable
    degrade_reason: requires_serp_tracking
    fallback: strict_degrade
    description: Organic search ranking position
    note: Requires SERP tracking service

  budget_pacing:
    source: ENGINE
    query_ref: campaigns.get_budget_pacing
    fallback: approx
    description: Current spend rate vs ideal even pacing
    unit: ratio
    refresh: hourly
    status: available

  top_of_search_share:
    source: ENGINE
    query_ref: campaigns.get_tos_impression_share
    fallback: approx
    description: Share of top-of-search ad impressions
    unit: ratio
    refresh: daily
    status: available

# (PR-B2 fields moved to evidence_sources section above)
# === Fallback Strategies ===

fallback_strategies:
  none:
    description: No fallback available - evidence marked as MISSING
    action: return_null

  approx:
    description: Use approximate value or category average
    action: return_estimate
    confidence_penalty: -0.2

  manual:
    description: Prompt user for manual input
    action: prompt_user
    confidence_penalty: -0.1

  # P6-A: Strict degrade for unavailable fields
  strict_degrade:
    description: Field unavailable - force low confidence in explanation
    action: return_null_with_reason
    confidence_penalty: -0.5
    forces_degrade: true
