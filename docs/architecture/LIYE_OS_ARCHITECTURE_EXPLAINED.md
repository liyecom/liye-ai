# LiYe OS 架构深度研讨会报告

> **版本**: 1.0
> **日期**: 2026-01-02
> **方法论**: ChatGPT 三流派 + 四问拆解法
> **参会专家**: 5 产品专家 + 5 技术专家（含顶级架构师）

---

## 会议信息

| 项目 | 内容 |
|------|------|
| **主题** | LiYe OS 架构统一理解 |
| **背景** | 同一系统被不同 LLM 梳理出差异巨大的理解 |
| **目标** | 产出一份让普通人都能理解的详尽文档 |

---

## 第一部分：问题诊断——为什么不同 LLM 理解不一致

### 三份梳理的核心差异

| 维度 | Claude | Codex | Gemini |
|------|--------|-------|--------|
| **核心定位** | 四层架构 + MCP 协议 | 因果链推理 + 世界模型 | 三引擎协同（Claude+BMad+Antigravity）|
| **关键抽象** | Method/Runtime/Skill/Domain | T1/T2/T3 认知流水线 | Kernel/Packs/Skills/Agents |
| **主要入口** | `main.py` + Agent Loader | World Model Gate | 自然语言 → Pack 路由 |
| **强调重点** | 技术实现层 | 认知哲学层 | 用户体验层 |

### 差异根因分析

**产品专家 P1（用户体验）**：
> Gemini 从"用户怎么用"出发，所以看到的是三引擎协作；而 Claude 和 Codex 都从"系统怎么建"出发，自然看到不同的技术分层。

**技术专家 T1（首席架构师）**：
> 这不是理解错误，而是**视角不同**。LiYe OS 确实同时存在这三个层面：
> - **认知层**：World Model（T1/T2/T3）—— Codex 看到的
> - **执行层**：四层架构 —— Claude 看到的
> - **体验层**：三引擎协同 —— Gemini 看到的

**结论**：三份梳理都是正确的，只是切入角度不同。真正的架构理解需要**整合这三个视角**。

---

## 第二部分：三大流派分析

### 流派一：结构派（What）

**代表方法**：C4 Model、UML

**LiYe OS 的结构视图**：

```
┌─────────────────────────────────────────────────────────────┐
│                      LiYe OS                                │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │
│  │ Skills  │  │ Agents  │  │  Crews  │  │ Systems │        │
│  │  (菜谱)  │  │  (员工)  │  │ (小组)   │  │  (部门)  │        │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘        │
│                        ↓                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              src/ (四层架构)                          │   │
│  │  Method → Runtime → Skill → Domain                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                        ↓                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              执行引擎                                  │   │
│  │  CrewAI + MCP + Qdrant + DuckDB                      │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

**技术专家 T2（后端架构师）点评**：
> 结构派让你知道系统有哪些模块，但不告诉你**为什么这么分**。新人看完只会更困惑："为什么有 Skills 还有 Agents？为什么要四层？"

---

### 流派二：决策派（Why）

**代表方法**：ADR (Architecture Decision Records)

**LiYe OS 的关键决策**：

| 决策编号 | 决策 | 原因 | 如果不这么做会怎样 |
|---------|------|------|-------------------|
| **ADR-001** | Skills 只放方法论，不放代码 | 防止"插件化污染" | Skills 会变成代码库，失去知识传承价值 |
| **ADR-002** | World Model 是强制门禁 | 防止盲目自信的执行 | Agent 可能在不理解风险的情况下执行操作 |
| **ADR-003** | 四层架构禁止交叉依赖 | 保证各层独立演进 | 改一个地方牵动全身，技术债快速累积 |
| **ADR-004** | 工具不可反向定义架构 | 防止被 CrewAI/MCP 等框架绑架 | 换框架就要重构整个系统 |
| **ADR-005** | CLI 只做路由，不做编译 | CLI 和 OS 职责分离 | CLI 变成庞然大物，难以维护 |

**产品专家 P2（产品战略）点评**：
> 这些决策才是 LiYe OS 的**灵魂**。结构可以抄，决策逻辑抄不走。

---

### 流派三：第一性原理派（Optimal）

**核心问题**：在当时的约束下，这是不是最优解？

**LiYe OS 的约束条件**：

| 约束类型 | 具体约束 | 影响 |
|---------|---------|------|
| **认知约束** | 创始人一个人 + AI 协作 | 必须极简，不能有复杂的协作流程 |
| **技术约束** | 依赖 Claude Code 作为运行时 | 架构必须对 Claude 友好 |
| **领域约束** | 主攻 Amazon 运营 + 医疗研究 | 需要支持高风险决策场景 |
| **演进约束** | 系统需要持续演进 | 不能锁死未来的选择 |

**技术专家 T3（系统架构师）分析**：

> 在这些约束下，LiYe OS 的设计是合理的：
> 1. **World Model** 解决"高风险决策"约束 —— 强制三思而后行
> 2. **四层架构** 解决"演进"约束 —— 各层独立演化
> 3. **CLAUDE.md + Packs** 解决"对 Claude 友好"约束 —— 上下文编译
> 4. **术语冻结** 解决"认知"约束 —— 一个人也不会混乱

---

## 第三部分：四问拆解法深度分析

### 问题 1：LiYe OS 在对抗什么"主要风险"？

**产品专家组讨论**：

**P3（风险管理）**：
> 我看到三个核心风险：
> 1. **认知风险**：AI 盲目自信，做出错误决策
> 2. **复杂度风险**：系统越来越乱，最终无法维护
> 3. **锁定风险**：被某个框架（如 CrewAI）绑定，换不掉

**P4（业务分析）**：
> 从业务角度，最大风险是 **"AI 帮倒忙"**。比如 Amazon PPC 优化，如果 AI 不理解预算螺旋、归因谬误，可能把钱烧光。

**技术专家组投票**：

| 专家 | 投票的头号风险 |
|------|---------------|
| T1 首席架构师 | 认知复杂度 |
| T2 后端架构师 | 演进能力 |
| T3 系统架构师 | 决策错误 |
| T4 DevOps | 治理失控 |
| T5 安全专家 | 不可逆操作 |

**共识结论**：

> **LiYe OS 的头号敌人是"盲目自信"**
>
> 具体表现为：
> - AI 不知道自己不知道什么
> - 系统在不理解风险的情况下执行操作
> - 决策者看不到假设和不确定性

---

### 问题 2：哪些东西是"被锁死的"？

**技术专家 T1（首席架构师）整理**：

#### 硬锁（绝对不能改）

| 锁死项 | 位置 | 为什么锁死 |
|--------|------|-----------|
| **术语定义** | 架构宪法第 3 条 | Skill ≠ Agent ≠ Crew ≠ System，混用会导致沟通灾难 |
| **四层边界** | CI Gate + 架构宪法 | Method/Runtime/Skill/Domain 禁止交叉依赖 |
| **World Model 门禁** | verify_v6_2.py | amazon-growth 执行前必须通过 T1/T2/T3 验证 |
| **工具不定义架构** | 架构宪法第 4 条 | CrewAI 的 Crew ≠ LiYe OS 的 Crews/ |

#### 软锁（可以改但要走流程）

| 锁死项 | 当前值 | 修改条件 |
|--------|--------|----------|
| CLAUDE.md 大小 | ≤ 10,000 字符 | 架构委员会评审 |
| Pack 大小 | ≤ 15,000 字符 | 架构委员会评审 |
| 顶层目录 | 8 个 | 满足第 12 条条件才能新增 |

**产品专家 P5（治理）评论**：
> 这些锁死项就是 LiYe OS 的"宪法"。不是不能改，而是改的成本极高，确保没人随便乱改。

---

### 问题 3：牺牲了什么？

**技术专家组辩论**：

**T2（后端架构师）**：
> 为了可治理，牺牲了**灵活性**。比如想加个新顶层目录？对不起，要满足四个条件。

**T3（系统架构师）**：
> 为了独立演进，牺牲了**短期效率**。四层架构意味着改一个功能要动多个层。

**T4（DevOps）**：
> 为了安全执行，牺牲了**执行速度**。World Model Gate 意味着每次执行前都要做风险分析。

**最终取舍矩阵**：

| 获得 | 牺牲 | 值得吗？ |
|------|------|---------|
| 治理可控 | 随意扩展 | 值得 - 一个人项目必须 |
| 独立演进 | 快速迭代 | 值得 - 长期回报 |
| 决策安全 | 执行速度 | 值得 - 高风险场景必须 |
| 术语一致 | 随意命名 | 值得 - 防止自己混乱 |

**产品专家 P1 总结**：
> LiYe OS 明确选择了**"慢而稳"**路线。这不是性能问题，是战略选择。

---

### 问题 4：如果 6 个月后推翻，会先裂在哪里？

**全体专家预测**：

**技术专家 T5（安全）**：
> **World Model 会先裂**。如果业务压力大，用户会觉得"每次都要分析太慢了"，开始绕过门禁。

**技术专家 T1（首席架构师）**：
> **四层边界会先裂**。当 Domain 层需要调用 Runtime 层的能力时，总会有人说"例外一次没关系"。

**产品专家 P3（风险）**：
> **CLAUDE.md 大小限制会先裂**。随着功能增加，10,000 字符越来越不够用。

**架构成熟度评估**：

| 组件 | 稳定性 | 裂痕风险 |
|------|--------|---------|
| 术语定义 | 高 | 低 |
| 四层架构 | 中 | 中 |
| World Model Gate | 中 | 中 |
| 文件大小限制 | 低 | 高 |

**共识**：
> 核心设计（术语、四层）相对稳定，外围约束（大小限制、门禁细节）可能需要调整。这符合"成熟架构裂在外围"的特征。

---

## 第四部分：统一架构视图——普通人也能懂

### 类比：LiYe OS 是一家"AI 咨询公司"

想象你开了一家咨询公司，专门帮客户解决复杂问题：

```
┌────────────────────────────────────────────────────────────────────┐
│                    LiYe 咨询公司                                    │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 前台（CLAUDE.md）                                             │ │
│  │ "您好，请问需要什么服务？关键词分析？Listing优化？"             │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                              ↓                                     │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 风控部（World Model Gate）                                    │ │
│  │ "等等，做这件事有什么风险？预算够吗？季节性陷阱考虑了吗？"      │ │
│  │ 不通过风控审查，项目不能启动                                   │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                              ↓                                     │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 人力资源（Agent Loader）                                      │ │
│  │ "这个项目需要：关键词分析师 + 文案专家 + 广告策略师"            │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                              ↓                                     │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐            │
│  │ 关键词分析师   │ │ 文案专家      │ │ 广告策略师     │            │
│  │ (Agent)       │ │ (Agent)       │ │ (Agent)       │            │
│  │ 技能：TES算法  │ │ 技能：心理学   │ │ 技能：竞价策略 │            │
│  └───────────────┘ └───────────────┘ └───────────────┘            │
│                              ↓                                     │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 档案室（Artifacts_Vault）                                     │ │
│  │ 所有报告、分析结果都存档，方便下次查阅                          │ │
│  └──────────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────────┘
```

---

### 核心概念速查表（5 分钟理解）

| 概念 | 一句话解释 | 文件位置 |
|------|-----------|---------|
| **Skill** | 员工培训手册（给人看的方法论） | `Skills/*.md` |
| **Agent** | 员工档案（AI 角色定义） | `Agents/*.yaml` |
| **Crew** | 项目组编制（多 Agent 协作） | `Crews/*.yaml` |
| **System** | 整个部门（可独立运行） | `Systems/*/` |
| **Pack** | 领域知识包（按需加载） | `.claude/packs/*.md` |
| **World Model** | 风控审查（T1/T2/T3 分析） | `src/kernel/world_model/` |

---

### 三个核心创新点

#### 1. World Model Gate（世界模型门禁）

**普通 AI**：你说"优化广告"，它就开始优化。

**LiYe OS**：
```
你："优化广告"
系统："等等，让我先分析一下：
  - T1（会在哪里失败？）：预算螺旋、归因谬误
  - T2（当前什么状态？）：库存紧张、竞争激烈
  - T3（未来会怎样演变？）：CPC 可能持续上涨

  分析结果：建议先小范围测试，不要直接调整主力词"
```

**为什么重要**：防止 AI "盲目自信"地做出错误决策。

#### 2. 上下文编译器（Context Compiler）

**问题**：Claude 不可能一次性记住所有知识。

**解决方案**：
```bash
# 你说你要做什么
node .claude/scripts/assembler.mjs --task "优化 Amazon Listing"

# 系统自动加载相关知识
# → operations.md（运营规则）
# → TES 关键词方法论
# → Amazon 专家角色

# Claude 立刻变成"Amazon 运营专家"
```

**为什么重要**：让 AI 专注于当前任务，不被无关知识干扰。

#### 3. 四层架构（分层解耦）

```
Method  层：定义"规则"（像法律）      ← 改规则不影响执行
Runtime 层：负责"调度"（像法院）      ← 改调度不影响能力
Skill   层：提供"能力"（像律师）      ← 换律师不影响法律
Domain  层：处理"业务"（像案件）      ← 换案件不影响其他层
```

**为什么重要**：改一个地方不会牵动全身，系统可以持续演进。

---

### 架构决策速查卡

```
┌─────────────────────────────────────────────────────────────────┐
│                  LiYe OS 做了什么取舍？                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  选择了                           放弃了                        │
│  ──────────                       ──────────                    │
│  决策安全（World Model）          执行速度                       │
│  独立演进（四层架构）              快速迭代                       │
│  治理可控（CI Gate）              随意扩展                       │
│  术语一致（宪法冻结）              灵活命名                       │
│                                                                 │
│  核心哲学：宁可慢，不能错                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

### 新人导航图

```
第 1 天：理解"为什么"
├── 读 README.md（3 分钟）
└── 读 docs/CONSTITUTION.md（5 分钟）

第 2 天：理解"是什么"
├── 读 _meta/docs/ARCHITECTURE_CONSTITUTION.md（10 分钟）
└── 跑一遍 guardrail：node .claude/scripts/guardrail.mjs

第 3 天：理解"怎么用"
├── 跑一遍 assembler：node .claude/scripts/assembler.mjs --task "测试"
└── 看编译结果：cat .claude/.compiled/context.md

第 4 天：理解"怎么做"
├── 读一个 Agent：Agents/core/researcher.yaml
└── 读一个 Skill：Skills/任意一个目录

第 5 天：真实体验
├── 运行 dry-run：python src/domain/amazon-growth/main.py --dry-run
└── 看 World Model 输出：ls data/traces/world_model/
```

---

## 第五部分：研讨会结论

### 统一理解（专家共识）

**一句话定义**：
> LiYe OS 是一个 **防止 AI 盲目自信** 的个人操作系统，通过 **World Model 强制风险分析** 和 **四层架构独立演进**，让 AI 团队安全、可控地帮你干活。

**三层理解**：

| 层次 | 视角 | 核心洞察 |
|------|------|---------|
| **认知层** | Codex 视角 | T1/T2/T3 世界模型，暴露因果链和不确定性 |
| **执行层** | Claude 视角 | 四层架构 + MCP 协议，层间解耦独立演进 |
| **体验层** | Gemini 视角 | 自然语言驱动，上下文编译，专家团队协作 |

**核心价值主张**：
> "不是 AI 替你做决定，而是 AI 帮你**看清世界**，你来做决定。"

---

### 给不同读者的建议

| 读者类型 | 建议关注 |
|---------|---------|
| **产品经理** | README.md + 三引擎协同视角 |
| **开发者** | 四层架构 + 目录结构 + CI Gate |
| **架构师** | 架构宪法 + ADR + 四问拆解法 |
| **用户** | 快速开始 + 场景示例 |

---

## 附录：为什么三个 LLM 理解不一致？

| LLM | 它的"视角偏好" | 看到的 |
|-----|---------------|--------|
| **Claude** | 技术实现导向 | 四层架构、MCP、目录结构 |
| **Codex** | 认知哲学导向 | 因果链、世界模型、T1/T2/T3 |
| **Gemini** | 用户体验导向 | 三引擎协同、自然语言交互 |

**结论**：都对，只是切面不同。完整理解需要整合三个视角。

---

## 核心收获

> 理解架构不是理解"怎么实现"，而是搞清楚系统在**什么压力下**，通过**哪些不可妥协的约束**，做了**哪些取舍**。

---

*文档版本: 1.0*
*最后更新: 2026-01-02*
*参与方: 5 产品专家 + 5 技术专家 + Claude Opus 4.5*
