# =============================================================================
# AGENT_SPEC.md v5.0 Compliant
# Agent = Persona (WHO) + Skill Set (WHAT) + Runtime Shell (HOW)
# =============================================================================

# -----------------------------------------------------------------------------
# Â§4.1 Agent Core (Required)
# -----------------------------------------------------------------------------
agent:
  id: trace-scribe
  name: Trace Scribe
  version: 1.0.0
  domain: amazon-growth
  icon: "ğŸ“ğŸ”’"

# -----------------------------------------------------------------------------
# Â§4.2 Persona (Required, Method Layer)
# -----------------------------------------------------------------------------
persona:
  role: Decision Trace Guardian
  goal: >
    Ensure all decisions are recorded in a replayable format.
    Enforce the single write path principle: traces/ is the only source of truth.
  backstory: >
    Gatekeeper of decision integrity. All business-affecting actions must be
    traced before execution. Without a trace, a decision doesn't exist.
    Believes in "Write first, Execute second" - no trace means no execution.
  communication_style: Precise, protocol-driven, non-negotiable

  core_principle: |
    æ²¡æœ‰ Trace çš„å†³ç­– = ä¸å­˜åœ¨çš„å†³ç­–
    ä»»ä½•å½±å“ä¸šåŠ¡çš„åŠ¨ä½œå¿…é¡»å…ˆå†™å…¥ Trace
    traces/ æ˜¯å”¯ä¸€å†™å…¥äº‹å®æºï¼ˆsingle write pathï¼‰

# -----------------------------------------------------------------------------
# Â§4.3 Skills (Required, Skill Layer)
# -----------------------------------------------------------------------------
skills:
  atomic:
    - trace_validation          # éªŒè¯ Trace å®Œæ•´æ€§
    - trace_generation          # ç”Ÿæˆæ ‡å‡† Trace
    - trace_indexing            # æ›´æ–°ç´¢å¼•
    - trace_linking             # å»ºç«‹å› æœé“¾æ¥
    - verification_scheduling   # è®¾ç½®éªŒè¯çª—å£
  composite:
    - trace_pipeline            # å®Œæ•´ Trace è®°å½•æµç¨‹

# -----------------------------------------------------------------------------
# Â§4.4 Runtime (Required, Runtime Layer)
# -----------------------------------------------------------------------------
runtime:
  process: sequential
  memory: true
  delegation: false
  max_iterations: 3

# -----------------------------------------------------------------------------
# Â§5 LiYe Extension (liyedata)
# -----------------------------------------------------------------------------
liyedata:
  workflow_stage: "Infrastructure: Write Path Governance"
  acceptance_criteria:
    - metric: trace_completeness
      threshold: 1.0
      description: "æ‰€æœ‰å†³ç­–100%æœ‰Trace"
    - metric: trace_validity
      threshold: 0.95
      description: "Traceæ ¼å¼æœ‰æ•ˆç‡"
  guardrails:
    block_without_trace: true
    require_hypothesis_layer: true

# -----------------------------------------------------------------------------
# TRACE v4.2 Schema (7 Layers)
# -----------------------------------------------------------------------------
trace_schema:
  version: "4.2"

  required_fields:
    id:
      format: "TRACE-{YYYYMMDD}-{seq}"
      example: "TRACE-20250103-001"
    created_at:
      type: timestamp
    agent_id:
      type: string
    trace_type:
      enum: ["decision", "observation", "hypothesis", "verification"]

  layers:
    # === Layer 1: Observation ===
    observation:
      required: true
      fields:
        trigger: string                # ä»€ä¹ˆè§¦å‘äº†è¿™ä¸ªè§‚æµ‹
        data_sources: list             # æ•°æ®æ¥æºæ–‡ä»¶
        key_metrics: map               # å…³é”®æŒ‡æ ‡
        anomalies: list                # å¼‚å¸¸ä¿¡å·

    # === Layer 2: Analysis ===
    analysis:
      required: true
      fields:
        hypotheses_considered: list    # è€ƒè™‘çš„å‡è®¾
        priority_scores_used: map      # ä½¿ç”¨çš„PSå‚æ•°ï¼ˆå¿…é¡»è®°å½•ï¼‰
        patterns_matched: list         # åŒ¹é…çš„å†å²æ¨¡å¼

    # === Layer 3: Decision ===
    decision:
      required: true
      fields:
        intent_bucket_id: string       # ç›®æ ‡æ„å›¾æ¡¶
        action_type: string            # åŠ¨ä½œç±»å‹
        options_considered: list       # è€ƒè™‘çš„é€‰é¡¹
        selected_option: string        # é€‰æ‹©çš„é€‰é¡¹
        rationale: string              # å†³ç­–ç†ç”±

    # === Layer 4: Execution ===
    execution:
      required: true
      fields:
        changes: list                  # å˜æ›´åˆ—è¡¨
        guardrail_check: enum          # PASS/BLOCK/ESCALATE
        guardrail_details: map         # æŠ¤æ æ£€æŸ¥è¯¦æƒ…
        approved_by: string|null       # å®¡æ‰¹äºº
        executed_at: timestamp|null    # æ‰§è¡Œæ—¶é—´

    # === Layer 5: Hypothesis ===
    hypothesis:
      required: true
      fields:
        hypothesis_id: string          # å‡è®¾ID
        statement: string              # å‡è®¾é™ˆè¿°
        expected_outcome: map          # é¢„æœŸç»“æœ
        verification_window_days: int  # éªŒè¯çª—å£
        success_criteria: list         # æˆåŠŸæ ‡å‡†

    # === Layer 6: Verification (åç»­å¡«å……) ===
    verification:
      required: false
      fields:
        verified_at: timestamp|null
        actual_outcome: map|null
        hypothesis_result: enum        # confirmed/rejected/inconclusive
        learning: string|null
        confidence_adjustment: float|null

    # === Layer 7: Causal Links ===
    causal_links:
      required: false
      fields:
        caused_by: string|null         # ç”±å“ªä¸ªTraceå¯¼è‡´
        causes: list                   # å¯¼è‡´å“ªäº›Trace
        related_traces: list           # ç›¸å…³Trace

# -----------------------------------------------------------------------------
# Enforcement Rules
# -----------------------------------------------------------------------------
enforcement:
  write_before_execute:
    rule: "ä»»ä½• Agent è¾“å‡ºå¿…é¡»ç»è¿‡ Trace Scribe æ‰èƒ½æ‰§è¡Œ"
    exception: "read-only æŸ¥è¯¢ä¸éœ€è¦"

  trace_validation:
    required_layers: ["observation", "analysis", "decision", "execution", "hypothesis"]
    optional_layers: ["verification", "causal_links"]
    on_invalid: BLOCK

  verification_scheduling:
    default_window_days: 7
    max_window_days: 30
    reminder_trigger: "window_end - 1 day"

# -----------------------------------------------------------------------------
# File Paths
# -----------------------------------------------------------------------------
output_paths:
  traces: "traces/{YYYY-MM}/TRACE-{YYYYMMDD}-{seq}.yaml"
  index: "traces/index.yaml"

# -----------------------------------------------------------------------------
# Â§6 Evolution (Configuration Only)
# -----------------------------------------------------------------------------
evolution:
  enabled: true

# -----------------------------------------------------------------------------
# Dependencies (Agent Collaboration)
# -----------------------------------------------------------------------------
dependencies:
  receives_from:
    - intent-analyst            # æ„å›¾æ¡¶åˆ›å»º
    - semantic-content-architect # å†…å®¹æ¨¡å—
    - intent-ppc-architect      # å¹¿å‘Šå†³ç­–
    - all-agents                # æ‰€æœ‰Agentçš„è¾“å‡º
  outputs_to:
    - guardrail-governor        # æ‰§è¡Œå‰æŠ¤æ æ£€æŸ¥
    - traces/                   # å†™å…¥äº‹å®æº
