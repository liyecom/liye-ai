name: Constitution - BMad Boundary Gate

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  bmad-boundary:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fail if BMAD leaks into Agents runtime layer
        run: |
          set -euo pipefail
          echo "=== Checking BMAD boundary ==="

          # Any BMAD references under Agents/ is forbidden
          BMAD_REFS=$(git grep -n -i "bmad" -- "Agents/" 2>/dev/null || true)
          if [ -n "$BMAD_REFS" ]; then
            echo "::error::BMAD references found under Agents/:"
            echo "$BMAD_REFS"
            echo "BMAD must stay in Roles/Context layer only."
            exit 1
          fi

          echo "âœ… BMAD boundary OK"
